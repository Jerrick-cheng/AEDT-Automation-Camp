Q. 自動化程式可以帶來什麼好處？

A. 完成一個複雜模擬需要上百個操作步驟才能完成。對於固定的應用(比方說天線設計)而言，某些操作步驟是固定的(比方說設Port, 設Radiation boundary，輸出天線參數)。如果這些固定操作步驟可以寫進到腳本之中，一鍵完成執行。一方面縮短操作時間，又避免了設定出錯的機會，一舉兩得。

對團隊來說，自動化程式可以統合模擬設定方法，避免個人對於模擬設定的見解不同發生模擬結果不一致的狀況發生。

---

Q. 我需要很會寫Python程式才能在AEDT上開發自動化程式嗎？

A. 不需要，自動化程式不會用到複雜的語法，只要知道下面這些就夠了：
- 基本型別及運算: string, int, float, boolean
- 基本型別資料結構及運算： list, tuple, dictionary
- 控制：if, else
- 迴圈：for, continue, break
- 匯入：Import
- 檔案讀寫函數：Open(), Close()
- 函數定義 def foo():
- 類別定義 class foo():

---

Q. 是不是學會Python就可以開發自動化程式了

A. 並不是。除了基本語法之外，你還要熟悉以下這些函式庫，你才能透過Python控制函式庫來與AEDT互動
- 基本函式庫：math, os, sys,...
- 進階函式庫：re, tkinter, matplotlib,...
- AEDT函式庫：Project, Design, Edit, Module

熟悉的意思並不是要背下所有的函式以及參數，而是要知道函式庫提供了何種功能，可以解決何種問題。只要知道如何發問問題，便可以透過Google找到答案。

---
Q. AEDT使用的是Iron Python，這和一般的Python有何差別？

A. 一般的Python又稱為Cpython。兩者的語法是類似的，內建基本函式庫也相同。但是目前多數科學用函式庫如Matplotlib，Scipy及Numpy僅支援Cpython。Iron Python主要建構在微軟的.NET框架，好處是可以使用到WPF技術在AEDT當中建立使用者介面。兩者都可以讀寫EXCEL或PPT，但是各自使用不同的函式庫。此外，目前Cpython已來到3.8版，而Iron Python仍停留在2.7版。已經會CPython的很容易就可以習慣IronPython。

---

Q. 可以從哪些步驟切入模擬自動化？

A. 初學者可以考慮下面幾個方向：
1. 前處理。比方說是建模，設port，合成電路原理圖等等。
2. 後處理。比方說是匯出模擬資料並生成報告，輸出模擬資源等。
3. 簡化操作。將多個步驟連接成單一步驟，並連接到熱鍵。

---

Q. 可以介紹"前處理"自動化嗎？

A. 在執行模擬之前，我們必須先完成設計或3D建模，材料庫的設定，Port的設置等等。對於某些設計，上述所提到的工作相當的繁複。例如大型天線陣列。手動設置往往曠日廢時又容易出錯。此時便可以透過前處理自動化來加速完成。前處理自動化主要是透過呼叫AEDT的API(Application Programming Interface)函式來完成建模或加入新的材料等等。一般開發前處理自動化程式的方式是先行錄製一段操作，再加以修改擴充。比方說是加入迴圈來重複其操作，以節省人為操作所耗費的時間。錄製的Python程式可以用一般文字編輯器加以修改，個人偏好Notepad++。

---

Q. 可以簡單描述"前處理"自動化的流程嗎？

A. 首先是錄製腳本，如果操作步驟繁複，可以分段錄製到不同的腳本當中。接下來將不同功能的程式碼包裝到不同函式當中，只留下需要的參數即可。每當包裝完一組程式碼，隨即編寫測試程式，如有必要可以用AddWarningMessage()將函式當中的變數輸出到AEDT的訊息視窗當中來協助除錯。最後串接所有程式之後進行完整功能測試。一切無誤，再視需要編寫使用者介面，並連結功能碼及使用者介面碼，完成開發工作。最後便是編寫使用說明並發布。
1. 錄製腳本
2. 函式包裝及測試
3. 整合函式並完成系統測試
4. 加入使用者介面
5. 編寫說明並發布

---


Q. 可以說明"後處理"自動化嗎？

A. 後處理指的是模擬後的資料處理。模擬的大量資料產出提供了設計的重要訊息，AEDT當中的各式報表可以支持大部分的需求，比方說是XY圖，表格，密度分布圖等等。但是一旦要分析的資料較為複雜，Report無法勝任時，我們便需要將模擬完成的原始資料匯出到第三方軟體(如Matlab, Python)來分析。這部分牽涉了資料匯出、運算、視覺化、排版等等。需要自動化來簡化這一連串的瑣碎流程。舉例來說，一組複雜的QFN封裝完成模擬之後，生成了上百組的RLC等效電路模型，便可以透過腳本快速找出RLC值超出標準的腳位，而不需要人工逐條檢視紀錄。

Anaconda支援了Pythoon語言，並支援Numpy及Scipy科學運算庫，Matplotlib繪圖庫，目前已在各個科學運算領域取代了Matlab成為工程師的首選，再加上其為開源軟體，可無償使用。是後處理自動化的首選。

---

Q. 在AEDT執行自動化程式的方式有哪些？

A. 主要方法有下列幾種：
- 從Automation執行script
- 從Toolkit執行script
- 熱鍵執行script
- ACT啟動GUI以執行script
- UDO(User Defined Outout)，建立客製化方程式
- UDP(User Defined Primitive)，建立客製化3D模型
- 將資料輸出到外部用Cpython處理(Anaconda)
- 透過批次檔控制AEDT完成前處理及後處理

---

Q. 完成一個AEDT自動化程式要多久時間？最大的困難是什麼？

A. 簡單的程式數十行代碼即可完成，開發時間不過數十分鐘。複雜的幾千行，開發時間需要數天到數周。這當然跟工程師對程式設計的掌握度及AEDT的熟悉度有絕對的關係。開發自動化程式需要使用到AEDT的函式庫，找到所需的函式並熟悉函式的輸出入是最花時間的地方。單單HFSS就提供了上千個函式，如果要透過人工從無到有開發自動化程式其工作量不敢想像。所幸AEDT可以讓使用者錄製操作步驟並輸出腳本，這約莫節省了80%函式查詢及學習的時間。另外20%的函數是"查詢"相關的函式無法透過錄製得到，便需要查找文件。

---

Q. 可以簡單介紹一下AEDT的函式庫嗎？

A. AEDT函式庫分成Desktop, Project, Design, Editor, Module等大類，Module底下又分成多個小類。比方說是要在專案底下加入新的設計，我們便可以使用oProject.InsertDesign()函數來完成。從功能區分，可分成CURD(Create:
建立, Update:更新, Read:讀取, Delete:刪除)四大塊。比方說是InsertDesign()屬於建立, SetActiveDesign()算是更新，GetName()屬於讀取，CutDesign()屬於刪除。當中CUD類可以透過錄製得到，而R類需要透過文件來查找。關於函式庫的Help檔可以在C:\Program Files\AnsysEM\AnsysEM20.1\Win64\Help底下找到ScriptingGuide.pdf當中詳細說明了函式的功能及使用方法。

---

Q. 如何讓使用者輸入參數到腳本當中？

A. 由易到難，有下列幾種方法：
1. 讓使用者在AEDT Properties視窗輸入參數，缺點是無法建立複雜的控件，如下拉式選單，或Radio Button。
2. 建立使用者介面。在Iron Python當中，有兩種方法可以產生使用者介面：
    - Tkinter (Linux & Windows)，用代碼方式編寫，較為繁複。
    - WPF (Windows)，可用拖放方法建立GUI，程式與介面分離。
3. 包裝成ACT(ANSYS Customization Toolkit)，ACT當中有較多控件可以使用。

---

Q. 如何不讓別人看到我腳本的程式碼？

A. 有兩種手段:
1. 編譯成.dll
2. 包裝成ACT(ANSYS Customization Toolkit)

---

Q. 可以說明ACT(ANSYS Customization Toolkit)嗎？

A. ACT是一種外掛套件的技術，在ANSYS的軟件上可以外掛ACT套件來提供額外的功能。由於軟體工具不可能滿足所有的需求，工程師便可以根據自己的需求編寫程式碼在ACT框架當中，來達到特定功能的需求。舉例來說，HFSS當中提供了Antenna ACT，使用者只要輸入頻段並選擇天線結構，ACT便自動生成天線3D模型，省去使用者建立模型的功夫。本質也是自動化的一種。與Script不同的是：
. 提供加密保護
. 支持簡單的GUI介面
. 可上架發售，App Store: https://catalog.ansys.com/

ACT的開發工具已經整合在AEDT環境當中，不需要額外license也不需要另外安裝。

---

Q. Matplotlib庫的用途為何？

A. 科學數據需要透過圖表來呈現其行為或趨勢。Matplotlib庫的函式可以讓使用者將大量的數值資料轉換成各式得圖表。圖表的格式極為豐富，請參考：https://matplotlib.org/3.1.1/gallery/index.html

---

Q. 熟悉檔案的讀寫為何重要？
A. AEDT存在許多的的設定檔，比方說是材料設定檔，激發設定檔，堆疊設定檔。以文字檔格式紀錄。對前處理來說，讀取設定檔便可以取得必要的訊息，也可以透過修改檔案來更新設計參數。對後處理來說，模擬結果都可以匯出到檔案當中。因此熟悉檔案的讀寫，對模擬自動化是必要的技能。

---

Q. 什麼是parser?
A. 檔案採用的資料種類及方法，根據資料的格式及之後要進行的運算，我們必須選擇適當的資料結構來儲存，才能有效的完成後續的工作。解析檔案並儲存至資料結構的程式稱之為parser。最常見的csv檔為例，csv parser便是將csv檔案讀到list of list的資料結構，使用者可以輕鬆的使用切片來取得某一列，某一行的資料。

---

Q. 我要將資料結構寫道檔案當中，有哪些考量？
A. 如果不考慮可讀性，最簡單的方式便是用pickle寫到檔案當中。檔案以二進制儲存，具有一定的保護性。如果考量到可讀性，CSV, Jason, xml,都是不錯的方式，有現成的庫可以使用。如果是自訂格式，則程式碼必須適當的格式化資料結構來產生符合規範的檔案格式。這部分通常需要耗費不少的時間來開發。

---

Q. 如何編寫parser?
A. Parser一般採用物件導向的方式來編寫，以物件來儲存資料並提供了各式的函式來應付常用的資料查詢及輸出。

---

Q. 何謂物件導向？
A. 物件導向與函式一樣都是用來包裹程式碼以達到可復用的目的。與函式不同的是物件是資料與函式的複合體，直接連結了資料及對應的函式，提供了比函式更高的整合性。python當中所有的結構都是屬於物件。python的物件導向甚至提供了魔法函式，讓使用者可以用符號直接操作物件。這也是python獨特的優勢之一。

---

Q. 如何理解AEDT的函式？
A. 要理解函式，必須先從輸出入著手。一個函式可以有多個輸入參數，也可以沒有輸入參數。必須以正確的資料型態傳入參數，函式才能正常地完成運算或執行動作。假設參數x是以字串表示的數值，舉例來說“23”，那麼以整數型別傳入23是不被接受的。這是初學者經常犯的錯誤。同樣的，返回資料的型態可能是單純的整數或字串，也可能是物件。清楚返回值的資料格式才能正確的加以處理。在閱讀AEDT的函式說明時，先觀察輸入參數的型別，必要時可以編寫程式碼片段來測試。

---

Q. 如何判斷返回資料的格式？
A. 最簡單的方式便是利用type()來得到資料型態，透過dir()來得到可以使用的函式。這裡舉一個簡單的例子：

---

Q. 如何包裹AEDT函式？
A. 錄製下來的函式結構一般來說相當的複雜，需要通過重新包裝來簡化結構以方便之後的使用。只需要保留必要的參數，其他設定為固定值，即可大幅簡化了函式的結構，舉例來說

---

Q. 用python生成報告有何好處？
A. 一般在完成模擬之後，工程師必須輸出圖表並擷取必要的資料，複製貼上到word或ppt當中來產生報告，以提供給主管或客戶參考，這是一件吃力不討好的工作，資料一多整理起來更是苦不堪言，一旦設計改版，全部的工作又必須重來一次。如果將報告的生成工作自動化，便可以讓工程師可以從繁瑣的剪貼操作解脫，去從事更有價值的技術研究。

---

Q. AEDT就有提供繪圖的功能，為何還需要使用matplotlib？

A. 首先，AEDT的所提供的繪圖種類遠不及matplotlib豐富，處裡速度也稍嫌緩慢，當輸出的圖片數量一多，差異就明顯看得出來。此外，有些資料需要先行處理再進行繪圖，如果外部處理完再匯回AEDT作圖豈不是多此一舉。然而，仍然有些圖必須由AEDT匯出，像是3D結構體或3D遠場圖。

---

Q. 如何整合圖片及數據甚或文字來產生報告？
A. 報告生成可以透過html來完成，html提供了各式的標籤，我們可以透過標籤來格式化文件，產生不同的字型大小，顏色，表格等。透過標籤也可以連接圖片及影片檔。由於html是文字格式，只要了解標籤的使用方式，我們便可以輕易地完成報告的編排。之後透過瀏覽器便可以檢視報告，並輸出pdf檔。

另一種方式是輸出到ppt當中。由於ironpython基於微軟.NET框架，不需另外安裝庫即可以使用內建函式讀寫Word, Excel, PowerPoint 等檔案。但是這部分的程式碼較為繁複，有興趣者可以上網查詢相關函式的使用方式。

---

Q. 可以簡單的說明html標籤的使用方式嗎？
A. Html的標籤是由<標籤名></標籤名>所組成。像是<H1>xxx</H1>當中xxx的輸出格式即是由標籤所控制。舉例來說H1到H6代表了不同標題文字的大小，可用來表示報告不同章節的副標題。所有的標籤定義可參考以下連結。

---

Q. 該如何在html當中產生表格？
A. 我們可以透過<table>標籤來建立表格。如果表格欄位很多且又存在合併欄位的話，要正確排列表格的標籤需要花一番功夫。所幸已經有人想到了這個問題，並提供了解決方法。底下的連結提供了視覺化工具，可以讓使用者透過點選的方式，輕易的建立表格格式並輸出對應的html標籤。只要加以包裹成函式，便可以輕鬆的輸出表格的html檔。

---

Q. 如何發展大程式碼？

A. 個人經驗，對自動化程式而言，100行以內算是小程式。中型程式則是100-1000行，超過1000行可以算是大程式。這裡的行數不包含空白行，註解。開發小程式不太需要考慮結構的問題。中型程式就必須以函數，甚至是物件導向來組織程式碼。大型程式會需要模組化。程式規模越大，除錯困難度也越高，因此需要考慮單元測試。

---

Q. 如何分解問題：根據csv紀錄的座標，複製物件到對應的位置？
A. 問題可分解如下：
— 如何標定物件？
— 如何定義物件的參考點？
— 複製的函式碼為何？
— csv的座標格式如何定義？
— 選擇何種資料結構來儲存座標？
— 如何讀取csv檔的資料到資料結構當中？
只要能從題目中找出這些底層的問題，便是成功的第一步。接下來便是要從程式設計的角度及使用者的預期來回答這些問題。這需要做一些小的代碼片段編程及測試，從各式的方法找到最適合的解答。當找出了所有的代碼片段，最後就是將它們組合起來即可。

---

Q. 可以針對”程式設計的角度及使用者的預期“說明的更清楚一點嗎？
A. 以“如何標定物件”為例，使用者該如何表示要複製的物件？可以是名稱，可以是某一類材料的物件，可以是符合某一種幾何結構的物件，也可以是某一種顏色的物件，又或者是框選到的物件。不同的標定方式對應者不同的代碼片段。標定方式的選擇取決於使用者的習慣及工作流程，這需要與使用者充分的溝通。自動化編程最忌自以為是，憑空想像。等到程式完工才發現不符合客戶的期望，所花的時間變得一場空。

---

Q. 那麼說，溝通是一件很重要的事了？
A. 除非使用者與編程者是同一人，否則溝通是無可避免。溝通所花的時間與精力往往還超過編程工作本身。溝通是軟體工程當中一個很重要的課題。這也正是模擬自動化很難普及的一個原因。模擬軟體有許多深奧的理論及工法，這很難說給專職的程式設計師理解。因此，由模擬軟體的使用者來開發自動化程式相對是一個比較可行的途徑。

---

Q. 寫自動化程式對模擬工程師個人的價值為何？
A. 模擬軟體的精通最多不過半年，之後是一個個案子不斷的的操作，其價值是很低的。工程師的價值是持續的攻克工程難題，這必須不斷的學習及思考。只是熟悉工具的操作不可能進階為領域的專家。透過自動化程式將成熟穩定的人工操作流程自動化。工程師才有閒暇去涉獵新的技術來進一步提升自己的個人價值。

---
